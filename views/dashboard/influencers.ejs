<%- include('../_includes/head') %>
<div class="dashboard-page">
    <%- include('../_includes/dashboardNavMini') %>
 
  <div class="dashboard">
    <div class="search-section">
      <div class="container-fluid deshheader">
          <%- include('../_includes/dashboardNav') %>
          <div class="col-12">
            <h3>Influences</h3>
            <div class="card withheading">
                <div class="dtablebox">
                    <table id="example" class="display nowrap cell-border" style="width:100%">
                      <thead>
                        <tr>
                          <th>User Name</th>
                          <th>Followers</th>
                          <th>Location</th>
                          <th>Information</th>
                        </tr>
                      </thead>
                      <tbody>
                          <% usr_array.forEach(elem => { var i = eng = 0%>
                        <tr>
                          <td><%= elem.user_name %></td>
                          <td><%= elem.followers_count %></td>
                          <td><%= elem.location %></td>
                          <!-- <td><%= elem.description %></td> -->
                          <td>
                          <div class="container">
                            <!-- Trigger the modal with a button -->
                            <a class="opendialoge">VIEW</a><!-- data-toggle="modal" data-target="#myModal<%= elem.user_id %>"-->
                            <div class="customviewmodel"></div>
                            <div class="contentarea">
                              <p><a href="javascript:void(0);" class="closedialoge">&times;</a></p>
                              <table id="example1" class="modal-body" style="width:100%">
                                <thead>
                                  <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                  </tr>
                                </thead>
                                <tbody>
                                   
                                    <tr>
                                        <td>User Profile Image</td>
                                        <td><img src=<%= elem.profile_image_url %>></td>
                                    </tr>
                                 
                                  <tr>
                                    <td>User Name</td>
                                    <td><%= elem.user_name %></td>
                                  </tr>
                                  <tr>
                                    <td>Screen Name</td>
                                    <td><%= elem.screen_name %></td>
                                  </tr>
                                  <tr>
                                      <td>Bio</td>
                                      <td><%= elem.description %></td>
                                    </tr>
                                    <% posts.forEach(p => {;%>
                                        <%if(p.user_name == elem.user_name){%>
                                            <%i = i+1%>
                                            <%eng = eng+p.retweet_count}%>
                                            <% }) %>
                                    <tr>
                                        <td>Posts</td>
                                        <td><%= i %></td>
                                      </tr>
                                       
                                      <tr>
                                          <td>Avg Eng</td>
                                          <td><%= (eng/i) %></td>
                                        </tr>
                                        <tr>
                                            <td>Followers</td>
                                            <td><%= elem.followers_count %></td>
                                          </tr>
                                          <tr>
                                              <td>Impressions</td>
                                              <td><%= elem.followers_count %></td>
                                            </tr>
                                            <tr>
                                                <td>Exposure</td>
                                                <td><%= elem.exposure %></td>
                                              </tr>
                                              
                                </tbody>
                              </table>

                              <table id="example1" class="modal-body" style="width:100%">
                                  <thead>
                                    <tr>
                                      <th colspan="2">Posts</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                        <% posts.forEach(p => {if(p.user_name == elem.user_name){%>
                                      <tr>
                                          <td>Posts</td>
                                          <td><%=p.text %></td>
                                      </tr>
                                   
                                    <tr>
                                      <td>Date</td>
                                      <td><%= p.date %></td>
                                    </tr>
                                    <tr>
                                      <td>Engagements</td>
                                      <td><%= (p.retweet_count+p.followers_count)%></td>
                                    </tr>
                                    
                                     
                                    <% }}) %>    
                                  </tbody>
                                </table>
                            </div>
                            
                          </div>
              
                        </td> 
                        <% }) %> 
                        </tr>
                        
                      </tbody>
                    </table>
                  </div>
            </div>
            </div>
  </div>
</div>


<div class="dash-footer">
  <p class="dash-copyright">
      <script>
          var d = new Date();
          var dy = d.getFullYear();
          document.write(dy);
      </script> Social Analysis. All Rights Reserved.
  </p>
</div>
<script>
$(document).ready(function() {  
    $('#example').DataTable( {  
      "scrollX": true,
      "bLengthChange": false,
        initComplete: function () {  
            this.api().columns().every( function () {  
                var column = this;  
                var select = $('<select><option value=""></option></select>')  
                    .appendTo( $(column.footer()).empty() )  
                    .on( 'change', function () {  
                        var val = $.fn.dataTable.util.escapeRegex(  
                            $(this).val()  
                        );  
                //to select and search from grid  
                        column  
                            .search( val ? '^'+val+'$' : '', true, false )  
                            .draw();  
                    } );  
   
                column.data().unique().sort().each( function ( d, j ) {  
                    select.append( '<option value="'+d+'">'+d+'</option>' )  
                } );  
            } );  
        }  
    } );  
} );
</script> 

<!-- <script>
  // Get the modal
  var modal = document.getElementById('myModal');
  
  // Get the button that opens the modal
  var btn = document.getElementById("myBtn");
  
  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];
  
  // When the user clicks the button, open the modal 
  btn.onclick = function() {
      modal.style.display = "block";
  }
  
  // When the user clicks on <span> (x), close the modal
  span.onclick = function() {
      modal.style.display = "none";
  }
  
  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
      if (event.target == modal) {
          modal.style.display = "none";
      }
  }
  </script> -->

<%- include('../_includes/noFooter') %>