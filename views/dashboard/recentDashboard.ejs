<%- include('../_includes/head') %>   
    <div class="dashboard">
        <div class="search-section">
            
            <div class="content-area">
                <!--<h2>Lorem Ipsum </h2>
    	<p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>-->
                <div class="dash-counter">
                    <ul>
                        <li><span class="number posts"><span class="countposts"><%= feedback[0] %></span></span><span
                                class="caption">Total Tweets</span></li>
                        <li><span class="number reach"><span class="countreach"><%= feedback[1] %></span></span><span
                                class="caption">Total Retweets</span></li>
                        <li><span class="number tweets"><span class="counttweet"><%= feedback[2] %></span></span><span
                                class="caption">Enagagement Level</span></li>
                       
                    </ul>
                </div>
            </div>
            <div class="chart-area">
                <canvas id="myChart"></canvas>
            </div>
            <div class="dtablebox">
                <table id="example" class="display nowrap cell-border" style="width:100%">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Tweet</th>
                            <th>User</th>
                            <th>Retweet</th>
                            <th>Favourite</th>
                            <th>Location</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% feedb.forEach(elem => { %>
                    
                        <tr>
                            <td> <%= elem.date %> </td>
        
                            <td><a target="_blank" href=<%=elem.url %>><%= elem.text %></a> </td>
                            <td><a target="_blank" href=<%=elem.profile_link %>><%= elem.user_name %> </a> </td>
                            <td> <%= elem.retweet_count %> </td>
                            <td> <%= elem.favorite_count %> </td>
                            <td> <%= elem.location %> </td>
                    
                        </tr>
                    
                    
                         <% }) %>
                    </tbody>
            </table>
            </div>
    </div>
</div>
<script>
    var data1 =  <%- JSON.stringify(feedb1) %>;
</script>
<script>
  $(document).ready(function() {  
    $('#example').DataTable( {  
      "scrollX": true,
        initComplete: function () {  
            this.api().columns().every( function () {  
                var column = this;  
                var select = $('<select><option value=""></option></select>')  
                    .appendTo( $(column.footer()).empty() )  
                    .on( 'change', function () {  
                        var val = $.fn.dataTable.util.escapeRegex(  
                            $(this).val()  
                        );  
                //to select and search from grid  
                        column  
                            .search( val ? '^'+val+'$' : '', true, false )  
                            .draw();  
                    } );  
   
                column.data().unique().sort().each( function ( d, j ) {  
                    select.append( '<option value="'+d+'">'+d+'</option>' )  
                } );  
            } );  
        }  
    } );  
} );
</script>

<script>

$(document).ready(function(e) {
	
	$({ Counter1: 0 }).animate({
  Counter1: $('.countposts').text()
}, {
  duration: 2000,
  easing: 'swing',
  step: function() {
    $('.countposts').text(Math.ceil(this.Counter1));
  }
});
	$({ Counter2: 0 }).animate({
  Counter2: $('.countreach').text()
}, {
  duration: 2000,
  easing: 'swing',
  step: function() {
    $('.countreach').text(Math.ceil(this.Counter2));
  }
});
	$({ Counter3: 0 }).animate({
  Counter3: $('.countusers').text()
}, {
  duration: 2000,
  easing: 'swing',
  step: function() {
    $('.countusers').text(Math.ceil(this.Counter3));
  }
});
	
            var ctweet = $('.counttweet').text();
            //$(this).css('-webkit-transform', 'rotate(' + now + 'deg)');
            $('.counttweet').prop('Counter', 0).animate({
                Counter: ctweet
            }, {
                duration: 2000,
                easing: 'linear',
                step: function(ctweet) {
                    $('.counttweet').text(Math.round(ctweet * 100) / 100);
                }
            });
            var cretweet = $('.countretweet').text();
            //$(this).css('-webkit-transform', 'rotate(' + now + 'deg)');
            $('.countretweet').prop('Counter', 0).animate({
                Counter: cretweet
            }, {
                duration: 2000,
                easing: 'linear',
                step: function(cretweet) {
                    $('.countretweet').text(Math.round(cretweet * 100) / 100);
                }
            });
    
});
</script>

<script>
  var ctx = document.getElementById('myChart').getContext('2d');
function convert(str) {
  var date = new Date(str),
    mnth = ("0" + (date.getMonth() + 1)).slice(-2),
    day = ("0" + date.getDate()).slice(-2);
  return [date.getFullYear(), mnth, day].join("-");
}
  var time_Array=[]
    var tweets = []
    var retweets = []
    var favs = []
    
    if(data1.length=="1"){
      for(var i =0;i<data1.length;i++){
      time_Array.push(convert((new Date( data1[i][1], (data1[i][2] -1), data1[i][3]))))
      tweets.push(data1[i][4])
      retweets.push(data1[i][5])
      favs.push(data1[i][7])  
    }
    console.log(time_Array)
    var myChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: ["",time_Array[0],""],
    datasets: [{
      label:"Tweets",
      backgroundColor: "rgba(153,255,51,0.4)",
      fill:false,
      borderColor:"rgba(153,255,51,0.4)",
      data: [null,tweets[0],null]
    }, {
      label:"Retweets",
      backgroundColor: "rgba(255,153,0,0.4)",
      fill:false,
      borderColor:"rgba(255,153,0,0.4)",
      data: [null,retweets[0],null]
    },{
      label:"Favourites",
      backgroundColor: "rgba(197, 239, 247, 1)",
      fill:false,
      borderColor:"rgba(197, 239, 247, 1)",
      data:[null,favs[0],null]
      }
      ]
  },
  options: {
         scales: {
            xAxes: [{
               gridLines: {
                  display: false
               }
            }],
            yAxes: [{
               ticks: {
                  display: true
               },
               gridLines: {
                  display: false,
               // drawBorder: false //maybe set this as well
               }
            }]
         },
        }
});}

else{
  for(var i =0;i<data1.length;i++){
      time_Array.push(convert((new Date( data1[i][1], (data1[i][2] -1), data1[i][3]))))
      tweets.push(data1[i][4])
      retweets.push(data1[i][5])
      favs.push(data1[i][7])  
    } 
  var myChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: time_Array,
    datasets: [{
      label:"Tweets",
      backgroundColor: "rgba(153,255,51,0.4)",
      fill:false,
      borderColor:"rgba(153,255,51,0.4)",
      data: tweets
    }, {
      label:"Retweets",
      backgroundColor: "rgba(255,153,0,0.4)",
      fill:false,
      borderColor:"rgba(255,153,0,0.4)",
      data: retweets
    },{
      label:"Favourites",
      backgroundColor: "rgba(197, 239, 247, 1)",
      fill:false,
      borderColor:"rgba(197, 239, 247, 1)",
      data:favs
      }
      ]
  },
  options: {
         scales: {
            xAxes: [{
               gridLines: {
                  display: false
               }
            }],
            yAxes: [{
               ticks: {
                  display: true
               },
               gridLines: {
                  display: false,
               // drawBorder: false //maybe set this as well
               }
            }]
         },
        }
});}  

    
</script>

<script src="/js/loader.js"></script>
<script src="/js/jquery.dataTables.min.js"></script>
<%- include('../_includes/noFooter') %>


